@page "/"
@using InvaMeetings.Web.Controllers
@using InvaMeetings.Web.Model
@inject UserService userService

<AuthorizeView>
    <Authorized>
        @{
            var applicationUserId = context.User.AsApplicationUser().UserId;
            var applicationUserName = context.User.AsApplicationUser().Name;
            var applicationUserFamilyName = context.User.AsApplicationUser().FamilyName;
            var applicationUserGivenName = context.User.AsApplicationUser().GivenName;
            var applicationUserEmail = context.User.AsApplicationUser().Email;

            UserModel userObject = new UserModel();

            userObject.UserId = applicationUserId;
            userObject.Name = applicationUserName;
            userObject.GivenName = applicationUserGivenName;
            userObject.FamilyName = applicationUserFamilyName;
            userObject.Email = applicationUserEmail;
            userObject.LastLoginDate = DateTime.Now;

            Task test = addUserToDatabase(userObject);
        }

    </Authorized>
</AuthorizeView>

@code{
    public async Task addUserToDatabase(UserModel user)
    {
        if (await userService.Get(user.UserId) == null)
        {
            Console.WriteLine("Registering new user..." + user.UserId);
            await userService.Add(user);
        }
        else
        {
            Console.WriteLine("Updating user last login date...");
            await userService.Update(user);
        }
    }

}